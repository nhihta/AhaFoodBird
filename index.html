<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>AhaBird</title>
    <!-- Open Graph cho Facebook -->
   <link rel="icon" type="image/png" href="https://github.com/nhihta/AhaFoodBird/blob/main/nen.png?raw=true">
<meta property="og:title" content="Game Hứng Bóng AhaFood.AI" />
<meta property="og:description" content="Chơi game hứng bóng vui nhộn và đặt món ngay trên AhaFood.AI!" />
<meta property="og:image" content="https://github.com/nhihta/AhaFoodBird/blob/main/nen.png?raw=true" />
<meta property="og:url" content="https://tenmiencuaban.com" />
<meta property="og:type" content="website" />

<!-- Zalo Link Preview -->
<meta name="zalo:image" content="https://github.com/nhihta/AhaFoodBird/blob/main/nen.png?raw=true" />
<meta name="zalo:title" content="Game Hứng Bóng AhaFood.AI" />
<meta name="zalo:description" content="Chơi game hứng bóng vui nhộn và đặt món ngay trên AhaFood.AI!" />
<style>
  :root { --ui:#222; --bg:linear-gradient(#88d7ff,#e6f7ff); }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  #wrap{position:relative; width:100vw; height:100vh; overflow:hidden;}
  canvas{display:block; width:100%; height:100%;}
  .hud{position:absolute; left:50%; transform:translateX(-50%); color:#fff; text-shadow:0 2px 4px rgba(0,0,0,.4); font-weight:800}
  #score{top:10px; font-size:32px; letter-spacing:1px}
  #centerUI{top:50%; transform:translate(-50%,-50%); text-align:center; color:var(--ui);}
  #title{font-size:40px; margin:0 0 6px}
  #tips{font-size:14px; opacity:.8; margin-bottom:16px}
  .btn{display:inline-block; padding:12px 20px; border-radius:12px; background:#111; color:#fff; font-weight:700; border:none; cursor:pointer}
  .sub{display:block; margin-top:10px; font-size:13px; opacity:.8}
</style>
</head>
<body>
<div id="wrap">
  <canvas id="game"></canvas>
  <div id="score" class="hud">0</div>
  <div id="centerUI" class="hud">
    <h1 id="title">AhaBird Mini</h1>
    <div id="stats"></div>
    <p id="tips">Nhấn <b>Start</b> rồi chạm màn hình (hoặc bấm Space) để bay qua các ống.</p>
    <button id="startBtn" class="btn">Start</button>
    <span class="sub">Mẹo: Tap ngắn & đều tay.</span>
  </div>
</div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const centerUI = document.getElementById('centerUI');
  const startBtn = document.getElementById('startBtn');
  const statsEl = document.getElementById('stats');
const logoImg = new Image();
logoImg.src = "logo.png"; // thay bằng tên file logo của bạn

  const birdImg = new Image();
birdImg.src = "AhaBird.png"; // tên file ảnh của bạn

  // Logical game size (we will scale with DPR)
  let W = 360, H = 640;
  function fitCanvas(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    cvs.width = W * dpr;
    cvs.height = H * dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  fitCanvas();
  addEventListener('resize', fitCanvas);

  // Game state
  const STATE = { READY:0, PLAYING:1, OVER:2 };
  let state = STATE.READY;

  // Bird physics
  const bird = {
    x: W*0.28,
    y: H*0.5,
    r: 14,
    vy: 0,
    gravity: 0.45,
    flap: -7.0,
    rot: 0
  };

  // Pipes
  let pipes = [];
  const pipeGapMin = 120, pipeGapMax = 150;
  const pipeW = 56;
  let pipeSpeed = 2.3;
  let pipeEvery = 90; // frames
  let frame = 0;

  // Score
  let score = 0;
  let best = Number(localStorage.getItem('flappy_best')||0);

  // Simple SFX (beeps) using WebAudio (tiny & offline)
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let ac;
  function beep(freq=600, dur=0.1, type='square', vol=0.1){
    try{
      if(!ac) ac = new AudioCtx();
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.value = vol;
      o.connect(g); g.connect(ac.destination);
      o.start();
      o.stop(ac.currentTime + dur);
    }catch(e){}
  }

  function resetGame(){
    bird.y = H*0.45;
    bird.vy = 0;
    bird.rot = 0;
    pipes = [];
    score = 0;
    frame = 0;
    pipeSpeed = 2.3;
    scoreEl.textContent = '0';
  }

  function rand(min,max){ return Math.random()*(max-min)+min; }

  function addPipe(){
    const gap = rand(pipeGapMin, pipeGapMax);
    const topH = rand(60, H - 200);
    const bottomY = topH + gap;
    pipes.push({
      x: W + pipeW,
      top: topH,
      bottomY: bottomY,
      passed: false
    });
  }

  function flap(){
    if(state === STATE.PLAYING){
      bird.vy = bird.flap;
      beep(700, .07, 'square', .07);
    }else if(state === STATE.READY){
      startGame();
    }else if(state === STATE.OVER){
      // ignore
    }
  }

  function startGame(){
    state = STATE.PLAYING;
    centerUI.style.display = 'none';
    resetGame();
  }

  function gameOver(){
    state = STATE.OVER;
    best = Math.max(best, score);
    localStorage.setItem('flappy_best', best);
    // Show UI
    statsEl.innerHTML = `<b>Điểm:</b> ${score} &nbsp;|&nbsp; <b>Kỷ lục:</b> ${best}`;
    startBtn.textContent = 'Chơi lại';
    centerUI.style.display = 'block';
    beep(180, .15, 'sawtooth', .06);
    beep(120, .20, 'sawtooth', .06);
  }

  // Controls
  addEventListener('touchstart', e => {
  if (centerUI.style.display !== 'none' && centerUI.contains(e.target)) return; // để UI nhận click
  e.preventDefault();
  flap();
}, { passive:false });

  addEventListener('mousedown', flap);
  addEventListener('keydown', e => {
    if(e.code === 'Space'){ e.preventDefault(); flap(); }
    if(e.code === 'Enter' && state !== STATE.PLAYING) startGame();
  });
  startBtn.addEventListener('click', () => {
    if(state !== STATE.PLAYING) startGame();
  });

  function drawBackground(){


    // sky
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#88d7ff');
    g.addColorStop(1,'#e6f7ff');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);
    // ground line
    ctx.fillStyle = '#77c26b';
    ctx.fillRect(0,H-40,W,40);
    ctx.fillStyle = '#5aa64f';
    ctx.fillRect(0,H-36,W,4);

        // Vẽ logo AhaFood.AI ở góc trên
if (logoImg.complete) {
  const logoW = 120;  // chiều rộng logo (px)
  const logoH = 40;   // chiều cao logo (px)
  ctx.drawImage(logoImg, W - logoW - 10, 10, logoW, logoH);
}
  }

  function drawBird(){
     ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.rotate(bird.rot);

  // Kích thước vẽ ảnh (có thể chỉnh scale nếu to/nhỏ quá)
  const size = bird.r * 4.5; // 4.5 = scale, chỉnh số này để phóng to/thu nhỏ
  ctx.drawImage(birdImg, -size/2, -size/2, size, size);

  ctx.restore();
  }

  function drawPipes(){
    ctx.fillStyle = '#4ec04e';
    ctx.strokeStyle = '#2d8f2d';
    ctx.lineWidth = 4;
    pipes.forEach(p => {
      // top pipe
      ctx.fillRect(p.x, 0, pipeW, p.top);
      ctx.strokeRect(p.x, 0, pipeW, p.top);
      // bottom pipe
      const bh = H - p.bottomY - 40;
      ctx.fillRect(p.x, p.bottomY, pipeW, bh);
      ctx.strokeRect(p.x, p.bottomY, pipeW, bh);

      // caps
      ctx.fillRect(p.x-3, p.top-12, pipeW+6, 12);
      ctx.fillRect(p.x-3, p.bottomY, pipeW+6, 12);
    });
  }

  function collide(){
    // ground
    if(bird.y + bird.r >= H-40) return true;
    if(bird.y - bird.r <= 0) return true;

    // with pipes (AABB vs circle simple check)
    for(const p of pipes){
      const inX = bird.x + bird.r > p.x && bird.x - bird.r < p.x + pipeW;
      if(inX){
        if(bird.y - bird.r < p.top || bird.y + bird.r > p.bottomY){
          return true;
        }
      }
    }
    return false;
  }

  function update(){
    frame++;

    if(state === STATE.PLAYING){
      // physics
      bird.vy += bird.gravity;
      bird.y += bird.vy;
      bird.rot = Math.max(-0.6, Math.min(0.9, (bird.vy/10)));

      // pipes
      if(frame % pipeEvery === 0) addPipe();
      pipes.forEach(p => p.x -= pipeSpeed);
      // remove offscreen
      pipes = pipes.filter(p => p.x + pipeW > -10);

      // scoring
      pipes.forEach(p => {
        if(!p.passed && p.x + pipeW < bird.x){
          p.passed = true;
          score++;
          scoreEl.textContent = score;
          beep(900, .06, 'square', .05);
          // slight difficulty ramp
          if(score % 5 === 0){
            pipeSpeed += 0.15;
            if(pipeEvery > 70) pipeEvery -= 2;
          }
        }
      });

      if(collide()){
        gameOver();
      }
    }
  }

  function render(){
    drawBackground();
    drawPipes();
    drawBird();
  }

  // Main loop
  function loop(){
    update();
    render();
    requestAnimationFrame(loop);
  }
  loop();

  // Show initial stats
  statsEl.innerHTML = `<b>Kỷ lục:</b> ${best}`;

  // Pause audio context when tab hidden (battery friendly)
  document.addEventListener('visibilitychange', () => {
    if(!ac) return;
    if(document.hidden) ac.suspend(); else ac.resume();
  });
})();
</script>
</body>
</html>

